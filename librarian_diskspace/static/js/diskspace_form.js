// Generated by CoffeeScript 1.10.0
(function(window, $, templates) {
  var addUuidField, diskForm, diskFormContainer, errorMessage, handleButton, section, submitData, url, uuidField;
  diskFormContainer = $('#dashboard-diskspace-panel');
  section = diskFormContainer.parents('.o-collapsible-section');
  diskForm = diskFormContainer.find('form');
  url = diskForm.attr('action');
  errorMessage = templates.diskspaceConsolidateSubmitError;
  uuidField = null;
  addUuidField = function() {
    var field;
    field = $('<input type="hidden" name="uuid">');
    diskForm.append(field);
    return field;
  };
  submitData = function(e) {
    var res;
    e.preventDefault();
    res = $.post(url, diskForm.serialize());
    res.done(function(data) {
      diskFormContainer.html(data);
    });
    res.fail(function() {
      diskFormContainer.prepend(errorMessage);
    });
    res.always(function() {
      section.trigger('remax');
    });
  };
  handleButton = function(e) {
    var el, uuid;
    el = $(e.target);
    uuid = el.attr('value');
    uuidField.val(uuid);
  };
  uuidField = addUuidField();
  diskFormContainer.on('click', 'button', handleButton);
  return diskFormContainer.on('submit', 'form', submitData);
})(this, this.jQuery, this.templates);
